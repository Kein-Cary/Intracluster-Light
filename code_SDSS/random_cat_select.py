import numpy as np
import astropy.constants as C
import astropy.units as U
import astroquery.sdss as asds
import astropy.io.fits as fits
import astropy.wcs as awc
import scipy.stats as sts

import h5py
import pandas as pds

from mpi4py import MPI
commd = MPI.COMM_WORLD
rank = commd.Get_rank()
cpus = commd.Get_size()

load = '/mnt/ddnfs/data_users/cxkttwl/ICL/data/'
dfile = '/mnt/ddnfs/data_users/cxkttwl/ICL/redMap_random/'

band = ['r', 'g', 'i', 'u', 'z']
def rule_out():
	data_lod = load + 'random_cat/cat_select/'
	csv_1 = 'rand_Excpt_r_sample.csv'
	csv_2 = 'rand_Excpt_g_sample.csv'
	csv_3 = 'rand_Excpt_i_sample.csv'
	#####
	except_ra_r = [ '237.858', '235.342', '199.545', '142.751', '352.392', '31.488',  '14.544',  '194.420', '14.177',  '213.093', '199.171', '123.718', '146.688', 
					'204.222', '211.595', '207.875', '356.916', '200.387', '27.179',  '142.036', '190.011', '217.431', '208.197', '181.690', '241.309', '349.120', 
					'178.576', '344.422', '121.982', '161.260', '197.346', '245.412', '152.366', '350.237', '203.608', '1.712',   '346.787', '187.690', '242.125', 
					'338.510', '245.728', '186.914', '139.867', '122.336', '138.937', '188.311', '161.734', '346.084', '355.373', '115.064', '23.835',  '173.994', 
					'351.784', '349.267', '19.161',  '154.352', '358.045', '198.924', '198.816', '200.766', '159.727', '253.525', '42.063',  '141.916', '241.148', 
					'170.557', '215.327', '221.783', '205.211', '240.343', '171.853', '344.394', '240.590', '195.108', '137.488', '118.183', '236.445', '151.088', 
					'351.617', '137.243', '124.444', '244.563', '155.394', '194.383', '223.350', '199.016', '22.169',  '176.823', '149.490', '186.537', '186.893', 
					'331.622', '233.775', '141.379', '138.975', '24.952',  '345.303', '352.229', '242.217', '215.832', '255.282', '151.938', '37.029',  '205.603', 
					'192.094', '28.575',  '359.125', '12.083',  '355.367', '333.330', '228.258', '176.247', '239.635', '245.562', '2.824',   '127.127', '157.290', 
					'357.501', '231.185', '138.116', '189.651', '154.657', '212.302', '182.624', '318.606', '258.995', '146.170', '112.773', '26.430',  '134.971', 
					'179.729', '136.393', '28.321',  '128.569', '209.387', '352.960', '22.644',  '234.134', '120.359', '351.165', '119.142', '246.292', '184.324', 
					'197.279', '3.313',   '172.729', '178.859', '171.542', '44.561',  '204.810', '245.115', '351.733', '183.248', '351.460', '245.962', '8.088',   
					'352.252', '215.800', '348.827', '43.180',  '202.187', '171.440', '240.504', '28.567',  '351.590', '11.325',  '348.680', '33.586',  '126.611', 
					'335.585', '181.434', '347.030', '145.224', '118.051', '132.818', '231.639', '164.900', '34.532',  '194.939', '12.452',  '249.153', '227.864', 
					'349.251', '180.027', '350.889', '330.578', '335.233', '190.606', '4.648',   '11.867',  '143.892', '317.746', '173.912', '222.217', '346.304', 
					'235.555', '131.818', '221.601', '145.066', '127.720', '126.262', '149.262', '184.875', '12.927',  '197.515', '160.740', '333.776', '348.484', 
					'185.904', '10.995',  '163.198', '227.726', '173.948', '5.019',   '13.057',  '31.380',  '195.428', '162.574', '128.758', '145.811', '212.929', 
					'354.541', '138.774', '144.353', '21.226',  ]

	except_dec_r = ['4.424',  '0.985',  '33.446', '59.002', '-2.438', '23.138', '16.292', '65.096', '13.947', '19.695', '17.143', '53.204', '11.913', 
					'13.601', '48.844', '21.608', '34.259', '2.684',  '28.421', '-1.447', '62.958', '31.617', '27.298', '42.830', '13.317', '6.493',  
					'53.632', '24.905', '51.416', '6.891',  '3.270',  '31.321', '20.560', '-6.184', '23.723', '28.390', '15.664', '23.832', '17.108', 
					'6.894',  '13.208', '1.869',  '26.165', '25.492', '52.689', '41.636', '22.866', '24.858', '26.002', '36.307', '9.803',  '36.271', 
					'-2.291', '28.466', '-2.384', '28.524', '30.460', '19.089', '16.056', '18.120', '29.484', '30.639', '4.387',  '47.477', '25.204', 
					'43.277', '3.320',  '53.497', '50.684', '39.292', '-1.759', '23.884', '11.601', '31.686', '60.086', '46.824', '15.254', '4.016',  
					'15.621', '41.000', '23.032', '57.704', '25.614', '12.298', '55.039', '7.991',  '17.318', '23.907', '16.313', '18.323', '41.429', 
					'-0.088', '50.237', '30.550', '21.296', '0.335',  '22.908', '19.932', '11.604', '25.738', '39.718', '21.773', '0.271',  '41.626', 
					'-3.318', '4.162',  '2.980',  '26.912', '31.527', '-1.574', '22.705', '9.157',  '36.891', '34.753', '18.893', '27.492', '34.645', 
					'0.997',  '37.075', '3.402',  '-0.779', '49.538', '15.818', '40.955', '1.660',  '43.147', '34.687', '36.223', '18.741', '32.254', 
					'1.754',  '5.075',  '15.080', '8.555',  '44.394', '28.702', '-2.032', '47.223', '9.002',  '23.797', '35.691', '27.596', '56.811', 
					'26.463', '-5.188', '40.207', '65.424', '33.218', '-2.484', '18.208', '49.119', '-1.506', '52.042', '35.318', '55.191', '19.655', 
					'23.154', '27.331', '6.207',  '-8.754', '-1.525', '40.965', '52.966', '8.727',  '33.902', '30.430', '14.856', '30.840', '3.301',  
					'15.722', '17.342', '3.595',  '2.749',  '19.163', '16.056', '19.666', '45.697', '-2.098', '30.725', '27.597', '43.603', '-1.706', 
					'-1.937', '19.385', '0.395',  '18.945', '28.179', '5.315',  '30.223', '11.605', '39.774', '7.060',  '63.575', '59.108', '25.367', 
					'37.096', '25.855', '50.741', '24.235', '5.032',  '50.390', '28.177', '36.874', '-5.076', '17.330', '53.318', '4.290',  '-6.078', 
					'-0.263', '-10.663','32.901', '33.084', '11.141', '16.320', '34.689', '25.174', '11.191', '23.423', '2.689',  '45.482', '6.189',  
					'32.531', '6.177',  '23.190', '23.915', ]

	except_z_r = [  '0.299', '0.297', '0.275', '0.219', '0.211', '0.248', '0.258', '0.218', '0.290', '0.292', '0.248', '0.261', '0.274', 
					'0.236', '0.260', '0.299', '0.285', '0.278', '0.276', '0.243', '0.234', '0.234', '0.298', '0.242', '0.275', '0.253', 
					'0.288', '0.293', '0.289', '0.291', '0.232', '0.207', '0.279', '0.273', '0.259', '0.295', '0.272', '0.242', '0.250', 
					'0.265', '0.266', '0.229', '0.259', '0.247', '0.238', '0.251', '0.282', '0.242', '0.226', '0.293', '0.231', '0.226', 
					'0.259', '0.294', '0.272', '0.273', '0.268', '0.239', '0.257', '0.246', '0.297', '0.206', '0.237', '0.240', '0.247', 
					'0.291', '0.300', '0.277', '0.228', '0.262', '0.227', '0.282', '0.282', '0.250', '0.254', '0.258', '0.265', '0.235', 
					'0.299', '0.254', '0.285', '0.280', '0.299', '0.277', '0.211', '0.212', '0.275', '0.243', '0.271', '0.264', '0.206', 
					'0.299', '0.274', '0.258', '0.268', '0.271', '0.242', '0.205', '0.243', '0.274', '0.227', '0.264', '0.287', '0.242', 
					'0.220', '0.240', '0.239', '0.290', '0.274', '0.254', '0.294', '0.247', '0.273', '0.247', '0.254', '0.227', '0.268', 
					'0.260', '0.278', '0.291', '0.259', '0.248', '0.267', '0.258', '0.258', '0.274', '0.219', '0.215', '0.256', '0.201', 
					'0.287', '0.230', '0.225', '0.228', '0.260', '0.257', '0.289', '0.241', '0.263', '0.298', '0.245', '0.266', '0.299', 
					'0.286', '0.277', '0.248', '0.232', '0.238', '0.230', '0.266', '0.273', '0.249', '0.294', '0.237', '0.211', '0.261', 
					'0.281', '0.220', '0.260', '0.212', '0.248', '0.280', '0.266', '0.268', '0.218', '0.233', '0.267', '0.265', '0.205', 
					'0.261', '0.266', '0.261', '0.227', '0.291', '0.209', '0.283', '0.206', '0.275', '0.245', '0.232', '0.252', '0.298', 
					'0.215', '0.216', '0.235', '0.241', '0.259', '0.275', '0.232', '0.219', '0.214', '0.210', '0.249', '0.206', '0.253', 
					'0.263', '0.259', '0.289', '0.288', '0.229', '0.239', '0.252', '0.223', '0.258', '0.237', '0.207', '0.217', '0.253', 
					'0.252', '0.247', '0.265', '0.244', '0.285', '0.225', '0.289', '0.250', '0.224', '0.240', '0.242', '0.282', '0.235', 
					'0.291', '0.217', '0.216', '0.245', ]

	x_ra = np.array( [ np.float(ll) for ll in except_ra_r] )
	x_dec = np.array( [ np.float(ll) for ll in except_dec_r] )
	x_z = np.array( [np.float(ll) for ll in except_z_r] )
	keys = ['ra', 'dec', 'z']
	values = [x_ra, x_dec, x_z]
	fill = dict(zip(keys, values))
	data = pds.DataFrame(fill)
	data.to_csv(data_lod + csv_1)
	#####
	except_ra_g = [ '237.858', '235.342', '199.545', '142.751', '352.392', '31.488',  '14.544',  '194.420', '14.177',  '213.093', '199.171', '123.718', '146.688', 
					'204.222', '211.595', '188.967', '142.036', '190.011', '217.431', '208.197', '181.690', '241.309', '349.120', '178.576', '344.422', '121.982', 
					'161.260', '197.346', '245.412', '152.366', '179.323', '346.787', '187.690', '242.125', '338.510', '245.728', '186.914', '139.867', '122.336', 
					'235.934', '346.084', '355.373', '115.064', '23.835',  '173.994', '351.784', '349.267', '19.161',  '154.352', '358.045', '198.924', '198.816', 
					'200.766', '324.850', '42.063',  '351.641', '141.916', '241.148', '170.557', '215.327', '221.783', '205.211', '240.343', '171.853', '344.394', 
					'240.590', '195.108', '137.488', '118.183', '236.445', '151.088', '359.981', '124.444', '244.563', '122.124', '223.350', '199.016', '22.169',  
					'176.823', '149.490', '186.537', '186.893', '331.622', '233.775', '330.898', '345.303', '352.229', '199.619', '242.217', '255.282', '172.568', 
					'151.938', '239.827', '227.063', '205.603', '192.094', '28.575',  '359.125', '12.083',  '355.367', '333.330', '342.278', '239.635', '229.694', 
					'2.824',   '127.127', '157.290', '357.501', '231.185', '138.116', '189.651', '154.657', '212.302', '182.624', '132.732', '116.306', '22.765',  
					'228.767', '26.430',  '134.971', '358.710', '179.729', '136.393', '28.321',  '128.569', '209.387', '352.960', '22.644',  '234.134', '120.359', 
					'351.165', '119.142', '246.292', '30.357',  '172.729', '35.569',  '13.963',  '187.151', '231.600', '145.599', '171.542', '332.818', '44.561',  
					'204.810', '245.115', '351.733', '183.248', '351.460', '245.962', '8.088',   '352.252', '215.800', '348.827', '43.180',  '202.187', '171.440', 
					'240.504', '28.567',  '351.590', '11.325',  '33.586',  '199.888', '349.164', '335.585', '171.344', '181.434', '196.415', '217.236', '149.929', 
					'118.051', '132.818', '231.639', '164.900', '34.532',  '194.939', '12.452',  '249.153', '227.864', '349.251', '180.027', '350.889', '330.578', 
					'335.233', '190.606', '4.648',   '11.867',  '143.892', '317.746', '173.912', '222.217', '346.304', '195.932', '235.555', '217.851', '166.219', 
					'344.002', '149.262', '0.110',   '12.927',  '197.515', '160.740', '333.776', '348.484', '185.904', '10.995',  '163.198', '227.726', '173.948', 
					'5.019',   '13.057',  '31.380',  '195.428', '162.574', '128.758', '145.811', '168.034', '357.651', '121.235', '138.774', '144.353', '219.718', 
					'329.889', '31.123',  '170.944', ]

	except_dec_g = ['4.424',  '0.985',  '33.446', '59.002', '-2.438', '23.138', '16.292', '65.096', '13.947', '19.695', '17.143', '53.204', '11.913', 
					'13.601', '48.844', '8.051',  '-1.447', '62.958', '31.617', '27.298', '42.830', '13.317', '6.493',  '53.632', '24.905', '51.416', 
					'6.891',  '3.270',  '31.321', '20.560', '10.483', '15.664', '23.832', '17.108', '6.894',  '13.208', '1.869',  '26.165', '25.492', 
					'52.884', '24.858', '26.002', '36.307', '9.803',  '36.271', '-2.291', '28.466', '-2.384', '28.524', '30.460', '19.089', '16.056', 
					'18.120', '9.200',  '4.387',  '25.447', '47.477', '25.204', '43.277', '3.320',  '53.497', '50.684', '39.292', '-1.759', '23.884', 
					'11.601', '31.686', '60.086', '46.824', '15.254', '4.016',  '21.296', '23.032', '57.704', '22.720', '55.039', '7.991',  '17.318', 
					'23.907', '16.313', '18.323', '41.429', '-0.088', '50.237', '-1.900', '22.908', '19.932', '17.857', '11.604', '39.718', '6.823',  
					'21.773', '31.237', '5.683',  '41.626', '-3.318', '4.162',  '2.980',  '26.912', '31.527', '-1.574', '18.949', '36.891', '5.222',  
					'18.893', '27.492', '34.645', '0.997',  '37.075', '3.402',  '-0.779', '49.538', '15.818', '40.955', '4.732',  '39.210', '25.775', 
					'33.606', '18.741', '32.254', '-5.359', '1.754',  '5.075',  '15.080', '8.555',  '44.394', '28.702', '-2.032', '47.223', '9.002',  
					'23.797', '35.691', '27.596', '7.792',  '40.207', '-1.178', '25.345', '49.764', '54.598', '16.931', '33.218', '23.929', '-2.484', 
					'18.208', '49.119', '-1.506', '52.042', '35.318', '55.191', '19.655', '23.154', '27.331', '6.207',  '-8.754', '-1.525', '40.965', 
					'52.966', '8.727',  '33.902', '30.430', '30.840', '35.844', '15.850', '15.722', '-1.578', '17.342', '55.244', '29.448', '59.870', 
					'19.163', '16.056', '19.666', '45.697', '-2.098', '30.725', '27.597', '43.603', '-1.706', '-1.937', '19.385', '0.395',  '18.945', 
					'28.179', '5.315',  '30.223', '11.605', '39.774', '7.060',  '63.575', '59.108', '25.367', '38.834', '37.096', '17.464', '66.166', 
					'26.557', '28.177', '-5.140', '-5.076', '17.330', '53.318', '4.290',  '-6.078', '-0.263', '-10.663','32.901', '33.084', '11.141', 
					'16.320', '34.689', '25.174', '11.191', '23.423', '2.689',  '45.482', '26.686', '-11.102','22.557', '6.177',  '23.190', '54.116', 
					'26.870', '3.737',  '36.558', ]

	except_z_g = [  '0.299', '0.297', '0.275', '0.219', '0.211', '0.248', '0.258', '0.218', '0.290', '0.292', '0.248', '0.261', '0.274', 
					'0.236', '0.260', '0.260', '0.243', '0.234', '0.234', '0.298', '0.242', '0.275', '0.253', '0.288', '0.293', '0.289', 
					'0.291', '0.232', '0.207', '0.279', '0.244', '0.272', '0.242', '0.250', '0.265', '0.266', '0.229', '0.259', '0.247', 
					'0.264', '0.242', '0.226', '0.293', '0.231', '0.226', '0.259', '0.294', '0.272', '0.273', '0.268', '0.239', '0.257', 
					'0.246', '0.269', '0.237', '0.260', '0.240', '0.247', '0.291', '0.300', '0.277', '0.228', '0.262', '0.227', '0.282', 
					'0.282', '0.250', '0.254', '0.258', '0.265', '0.235', '0.229', '0.285', '0.280', '0.287', '0.211', '0.212', '0.275', 
					'0.243', '0.271', '0.264', '0.206', '0.299', '0.274', '0.237', '0.242', '0.205', '0.261', '0.243', '0.227', '0.262', 
					'0.264', '0.216', '0.233', '0.242', '0.220', '0.240', '0.239', '0.290', '0.274', '0.254', '0.284', '0.273', '0.272', 
					'0.254', '0.227', '0.268', '0.260', '0.278', '0.291', '0.259', '0.248', '0.267', '0.258', '0.293', '0.246', '0.282', 
					'0.219', '0.256', '0.201', '0.260', '0.287', '0.230', '0.225', '0.228', '0.260', '0.257', '0.289', '0.241', '0.263', 
					'0.298', '0.245', '0.266', '0.220', '0.248', '0.229', '0.245', '0.284', '0.231', '0.298', '0.238', '0.244', '0.230', 
					'0.266', '0.273', '0.249', '0.294', '0.237', '0.211', '0.261', '0.281', '0.220', '0.260', '0.212', '0.248', '0.280', 
					'0.266', '0.268', '0.218', '0.233', '0.265', '0.267', '0.242', '0.261', '0.239', '0.266', '0.264', '0.280', '0.248', 
					'0.291', '0.209', '0.283', '0.206', '0.275', '0.245', '0.232', '0.252', '0.298', '0.215', '0.216', '0.235', '0.241', 
					'0.259', '0.275', '0.232', '0.219', '0.214', '0.210', '0.249', '0.206', '0.253', '0.261', '0.263', '0.261', '0.267', 
					'0.249', '0.252', '0.237', '0.258', '0.237', '0.207', '0.217', '0.253', '0.252', '0.247', '0.265', '0.244', '0.285', 
					'0.225', '0.289', '0.250', '0.224', '0.240', '0.242', '0.282', '0.233', '0.231', '0.288', '0.217', '0.216', '0.244', 
					'0.210', '0.261', '0.267', ]

	x_ra = np.array( [ np.float(ll) for ll in except_ra_g] )
	x_dec = np.array( [ np.float(ll) for ll in except_dec_g] )
	x_z = np.array( [np.float(ll) for ll in except_z_g] )
	keys = ['ra', 'dec', 'z']
	values = [x_ra, x_dec, x_z]
	fill = dict(zip(keys, values))
	data = pds.DataFrame(fill)
	data.to_csv(data_lod + csv_2)
	#####
	except_ra_i = [ '237.858', '235.342', '199.545', '142.751', '352.392', '31.488',  '14.544',  '194.420', '14.177',  '213.093', '199.171', '123.718', '146.688', 
					'204.222', '166.125', '30.050',  '356.916', '200.387', '188.967', '27.179',  '178.992', '153.578', '142.036', '190.011', '217.431', '208.197', 
					'181.690', '241.309', '349.120', '178.576', '344.422', '121.982', '161.260', '197.346', '245.412', '152.366', '190.295', '350.237', '188.157', 
					'317.119', '171.498', '346.787', '187.690', '242.125', '338.510', '245.728', '186.914', '139.867', '122.336', '138.937', '346.084', '355.373', 
					'115.064', '23.835',  '173.994', '351.784', '349.267', '19.161',  '154.352', '358.045', '198.924', '198.816', '200.766', '199.844', '159.727', 
					'42.944',  '127.859', '253.525', '125.220', '188.402', '27.621',  '125.792', '141.916', '241.148', '170.557', '215.327', '221.783', '205.211', 
					'240.343', '171.853', '344.394', '240.590', '195.108', '137.488', '118.183', '137.243', '155.394', '194.383', '137.609', '123.948', '162.701', 
					'255.226', '223.350', '199.016', '22.169',  '176.823', '149.490', '186.537', '186.893', '331.622', '233.775', '141.379', '138.975', '24.952',  
					'193.557', '178.600', '172.504', '215.832', '30.494',  '327.207', '205.603', '192.094', '28.575',  '359.125', '12.083',  '355.367', '333.330', 
					'21.226',  '176.247', '234.999', '221.678', '239.635', '245.562', '2.824',   '127.127', '157.290', '357.501', '231.185', '138.116', '189.651', 
					'154.657', '212.302', '182.624', '318.606', '258.995', '146.170', '112.773', '26.430',  '134.971', '336.862', '116.306', '200.720', '246.209', 
					'349.398', '253.928', '26.160',  '196.736', '179.729', '119.628', '136.393', '28.321',  '128.569', '209.387', '352.960', '22.644',  '234.134', 
					'120.359', '351.165', '119.142', '205.674', '187.320', '216.256', '239.399', '147.030', '3.313',   '172.729', '35.569',  '29.334',  '14.068',  
					'215.927', '44.561',  '204.810', '245.115', '351.733', '183.248', '351.460', '245.962', '8.088',   '352.252', '215.800', '348.827', '43.180',  
					'202.187', '171.440', '240.504', '28.567',  '351.590', '11.325',  '230.132', '181.788', '229.467', '245.897', '126.611', '219.385', '347.030', 
					'21.631',  '16.277',  '141.920', '167.517', '160.130', '118.051', '132.818', '231.639', '164.900', '34.532',  '194.939', '12.452',  '249.153', 
					'227.864', '349.251', '180.027', '350.889', '330.578', '335.233', '190.606', '4.648',   '11.867',  '143.892', '317.746', '173.912', '222.217', 
					'346.304', '226.440', '131.818', '221.601', '180.648', '26.882',  '145.066', '175.756', '197.515', '160.740', '333.776', '348.484', '185.904', 
					'10.995',  '163.198', '227.726', '173.948', '5.019',   '13.057',  '31.380',  '195.428', '162.574', '128.758', '354.541', '242.858', '115.554', 
					'142.116', '21.226',  ]

	except_dec_i = ['4.424',  '0.985',  '33.446', '59.002', '-2.438', '23.138', '16.292', '65.096', '13.947', '19.695', '17.143', '53.204', '11.913', 
					'13.601', '20.423', '31.727', '34.259', '2.684',  '8.051',  '28.421', '26.799', '28.227', '-1.447', '62.958', '31.617', '27.298', 
					'42.830', '13.317', '6.493',  '53.632', '24.905', '51.416', '6.891',  '3.270',  '31.321', '20.560', '-3.276', '-6.184', '34.726', 
					'3.335',  '46.496', '15.664', '23.832', '17.108', '6.894',  '13.208', '1.869',  '26.165', '25.492', '52.689', '24.858', '26.002', 
					'36.307', '9.803',  '36.271', '-2.291', '28.466', '-2.384', '28.524', '30.460', '19.089', '16.056', '18.120', '40.287', '29.484', 
					'-4.561', '0.047',  '30.639', '4.908',  '59.444', '6.826',  '47.209', '47.477', '25.204', '43.277', '3.320',  '53.497', '50.684', 
					'39.292', '-1.759', '23.884', '11.601', '31.686', '60.086', '46.824', '41.000', '25.614', '12.298', '29.790', '11.791', '10.226', 
					'38.090', '55.039', '7.991',  '17.318', '23.907', '16.313', '18.323', '41.429', '-0.088', '50.237', '30.550', '21.296', '0.335',  
					'54.016', '47.647', '-1.896', '25.738', '6.347',  '9.989',  '41.626', '-3.318', '4.162',  '2.980',  '26.912', '31.527', '-1.574', 
					'23.915', '9.157',  '2.469',  '1.375',  '36.891', '34.753', '18.893', '27.492', '34.645', '0.997',  '37.075', '3.402',  '-0.779', 
					'49.538', '15.818', '40.955', '1.660',  '43.147', '34.687', '36.223', '18.741', '32.254', '27.726', '39.210', '36.889', '29.400', 
					'24.803', '23.751', '29.252', '40.854', '1.754',  '23.569', '5.075',  '15.080', '8.555',  '44.394', '28.702', '-2.032', '47.223', 
					'9.002',  '23.797', '35.691', '0.958',  '54.451', '51.297', '11.206', '6.984',  '-5.188', '40.207', '-1.178', '30.747', '1.925',  
					'-1.577', '-2.484', '18.208', '49.119', '-1.506', '52.042', '35.318', '55.191', '19.655', '23.154', '27.331', '6.207',  '-8.754', 
					'-1.525', '40.965', '52.966', '8.727',  '33.902', '30.430', '25.283', '13.569', '36.356', '30.852', '3.301',  '36.696', '3.595',  
					'29.491', '33.468', '7.326',  '27.386', '-1.631', '19.163', '16.056', '19.666', '45.697', '-2.098', '30.725', '27.597', '43.603', 
					'-1.706', '-1.937', '19.385', '0.395',  '18.945', '28.179', '5.315',  '30.223', '11.605', '39.774', '7.060',  '63.575', '59.108', 
					'25.367', '20.499', '25.855', '50.741', '-0.142', '28.946', '24.235', '26.892', '17.330', '53.318', '4.290',  '-6.078', '-0.263', 
					'-10.663','32.901', '33.084', '11.141', '16.320', '34.689', '25.174', '11.191', '23.423', '2.689',  '32.531', '56.856', '42.737', 
					'0.989',  '23.915', ]

	except_z_i = [  '0.299', '0.297', '0.275', '0.219', '0.211', '0.248', '0.258', '0.218', '0.290', '0.292', '0.248', '0.261', '0.274', 
					'0.236', '0.261', '0.276', '0.285', '0.278', '0.260', '0.276', '0.242', '0.207', '0.243', '0.234', '0.234', '0.298', 
					'0.242', '0.275', '0.253', '0.288', '0.293', '0.289', '0.291', '0.232', '0.207', '0.279', '0.255', '0.273', '0.259', 
					'0.253', '0.290', '0.272', '0.242', '0.250', '0.265', '0.266', '0.229', '0.259', '0.247', '0.238', '0.242', '0.226', 
					'0.293', '0.231', '0.226', '0.259', '0.294', '0.272', '0.273', '0.268', '0.239', '0.257', '0.246', '0.268', '0.297', 
					'0.220', '0.246', '0.206', '0.225', '0.203', '0.281', '0.263', '0.240', '0.247', '0.291', '0.300', '0.277', '0.228', 
					'0.262', '0.227', '0.282', '0.282', '0.250', '0.254', '0.258', '0.254', '0.299', '0.277', '0.263', '0.261', '0.216', 
					'0.289', '0.211', '0.212', '0.275', '0.243', '0.271', '0.264', '0.206', '0.299', '0.274', '0.258', '0.268', '0.271', 
					'0.274', '0.285', '0.246', '0.274', '0.286', '0.281', '0.242', '0.220', '0.240', '0.239', '0.290', '0.274', '0.254', 
					'0.245', '0.247', '0.286', '0.243', '0.273', '0.247', '0.254', '0.227', '0.268', '0.260', '0.278', '0.291', '0.259', 
					'0.248', '0.267', '0.258', '0.258', '0.274', '0.219', '0.215', '0.256', '0.201', '0.297', '0.246', '0.268', '0.248', 
					'0.275', '0.262', '0.220', '0.226', '0.287', '0.249', '0.230', '0.225', '0.228', '0.260', '0.257', '0.289', '0.241', 
					'0.263', '0.298', '0.245', '0.293', '0.210', '0.279', '0.251', '0.284', '0.277', '0.248', '0.229', '0.268', '0.262', 
					'0.277', '0.230', '0.266', '0.273', '0.249', '0.294', '0.237', '0.211', '0.261', '0.281', '0.220', '0.260', '0.212', 
					'0.248', '0.280', '0.266', '0.268', '0.218', '0.233', '0.293', '0.260', '0.260', '0.239', '0.205', '0.291', '0.261', 
					'0.268', '0.268', '0.204', '0.244', '0.283', '0.291', '0.209', '0.283', '0.206', '0.275', '0.245', '0.232', '0.252', 
					'0.298', '0.215', '0.216', '0.235', '0.241', '0.259', '0.275', '0.232', '0.219', '0.214', '0.210', '0.249', '0.206', 
					'0.253', '0.252', '0.259', '0.289', '0.253', '0.201', '0.288', '0.272', '0.237', '0.207', '0.217', '0.253', '0.252', 
					'0.247', '0.265', '0.244', '0.285', '0.225', '0.289', '0.250', '0.224', '0.240', '0.242', '0.291', '0.223', '0.283', 
					'0.299', '0.245', ]

	x_ra = np.array( [ np.float(ll) for ll in except_ra_i] )
	x_dec = np.array( [ np.float(ll) for ll in except_dec_i] )
	x_z = np.array( [np.float(ll) for ll in except_z_i] )
	keys = ['ra', 'dec', 'z']
	values = [x_ra, x_dec, x_z]
	fill = dict(zip(keys, values))
	data = pds.DataFrame(fill)
	data.to_csv(data_lod + csv_3)

	return

def edge_out():
	## rule out those imgs: the center pix is beyond the frame
	with h5py.File(load + 'mpi_h5/redMapper_rand_cat.h5', 'r') as f:
		tmp_array = np.array(f['a'])
	ra, dec, z, rich = np.array(tmp_array[0]), np.array(tmp_array[1]), np.array(tmp_array[2]), np.array(tmp_array[3])
	zN = len(z)
	doc = open(load + 'random_cat/cat_select/cx_cy_pix_beyond_frame.txt', 'w')
	for ii in range(zN):
		ra_g, dec_g, z_g = ra[ii], dec[ii], z[ii]

		try:
			pro_f = dfile + 'rand_img-r-ra%.3f-dec%.3f-redshift%.3f.fits.bz2' % (ra_g, dec_g, z_g)
			data_f = fits.open(pro_f)
			img = data_f[0].data
			head_inf = data_f[0].header
			wcs = awc.WCS(head_inf)
			cx_BCG, cy_BCG = wcs.all_world2pix(ra_g*U.deg, dec_g*U.deg, 1)
			lx, ly = img.shape[1], img.shape[0]

			if (cx_BCG < 0.) | (cx_BCG > lx - 1.):
				s = '%.3f, %.3f, %.3f' % (ra_g, dec_g, z_g)
				print(s, file = doc, )
			elif (cy_BCG < 0.) | (cy_BCG > ly - 1.):
				s = '%.3f, %.3f, %.3f' % (ra_g, dec_g, z_g)
				print(s, file = doc, )
			else:
				continue

		except FileNotFoundError:
			s = '%.3f, %.3f, %.3f' % (ra_g, dec_g, z_g)
			print(s, file = doc, )
			continue

	doc.close()
	return

def main():

	rule_out()
	#edge_out()

	# center pix beyond frame imgs
	dat_cen = pds.read_csv(load + 'random_cat/cat_select/cx_cy_pix_beyond_frame.txt')
	cen_ra = np.array(dat_cen.ra)
	cen_dec = np.array(dat_cen.dec)
	cen_z = np.array(dat_cen.z)
	out_ra = ['%.3f' % ll for ll in cen_ra]
	out_dec = ['%.3f' % ll for ll in cen_dec]
	out_z = ['%.3f' % ll for ll in cen_z]

	with h5py.File(load + 'mpi_h5/redMapper_rand_cat.h5', 'r') as f:
		tmp_array = np.array(f['a'])
	ra, dec, z, rich = np.array(tmp_array[0]), np.array(tmp_array[1]), np.array(tmp_array[2]), np.array(tmp_array[3])
	zN, bN = len(z), len(band)

	for kk in range(3):
		# bad images
		dat = pds.read_csv(load + 'random_cat/cat_select/rand_Excpt_%s_sample.csv' % band[kk] )
		excpt_ra = np.array(dat.ra)
		excpt_dec = np.array(dat.dec)
		excpt_z = np.array(dat.z)
		rul_ra = ['%.3f' % ll for ll in excpt_ra]
		rul_dec = ['%.3f' % ll for ll in excpt_dec]
		rul_z = ['%.3f' % ll for ll in excpt_z]

		sub_z = []
		sub_ra = []
		sub_dec = []
		sub_rich = []

		for jj in range(zN):
			ra_g = ra[jj]
			dec_g = dec[jj]
			z_g = z[jj]
			rich_g = rich[jj]

			identi = ('%.3f' % ra_g in rul_ra) & ('%.3f' % dec_g in rul_dec) # & ('%.3f' % z_g in rul_z)
			identi_cen = ('%.3f' % ra_g in out_ra) & ('%.3f' % dec_g in out_dec) # & ('%.3f' % z_g in out_z)
			if  identi == True:
				continue
			elif identi_cen == True:
				continue
			else:
				sub_z.append(z_g)
				sub_ra.append(ra_g)
				sub_dec.append(dec_g)
				sub_rich.append(rich_g)

		sub_z = np.array(sub_z)
		sub_ra = np.array(sub_ra)
		sub_dec = np.array(sub_dec)
		sub_rich = np.array(sub_rich)

		## save the csv file
		keys = ['ra', 'dec', 'z', 'rich']
		values = [sub_ra, sub_dec, sub_z, sub_rich]
		fill = dict(zip(keys, values))
		data = pds.DataFrame(fill)
		data.to_csv(load + 'random_cat/cat_select/rand_%s_band_catalog.csv' % band[kk])
		## save the h5 files for "mpirun"
		sub_array = np.array([sub_ra, sub_dec, sub_z, sub_rich])
		with h5py.File(load + 'random_cat/cat_select/rand_%s_band_catalog.h5' % band[kk], 'w') as f:
			f['a'] = np.array(sub_array)

		with h5py.File(load + 'random_cat/cat_select/rand_%s_band_catalog.h5' % band[kk]) as f:
			for tt in range( len(sub_array) ):
				f['a'][tt,:] = sub_array[tt,:]

if __name__ == "__main__":
	main()
